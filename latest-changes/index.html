<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŒ¿ BlossomX- Your Travel Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
   <link rel="stylesheet" href="Style.css">
</head>
<body>
    <!-- Floating decorative elements -->
    <div class="floating" style="width: 200px; height: 200px; background: rgba(76, 175, 80, 0.05); top: 10%; left: 5%; animation-delay: 0s;"></div>
    <div class="floating" style="width: 300px; height: 300px; background: rgba(139, 195, 74, 0.05); top: 30%; right: 5%; animation-delay: 2s;"></div>
    <div class="floating" style="width: 150px; height: 150px; background: rgba(255, 193, 7, 0.05); bottom: 20%; left: 10%; animation-delay: 4s;"></div>
    
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-leaf"></i>
                <span>BlossomX</span>
            </div>
            <div class="user-profile">
                <span id="username">Loading...</span>
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <h1>AI-Powered Travel & Expense Management</h1>
        
        <!-- Travel Planning Section -->
        <div class="search-container">
            <div class="search-tabs">
                <div class="tab active" data-type="roundtrip">Round Trip</div>
                <div class="tab" data-type="oneway">One Way</div>
                <div class="tab" data-type="multicity">Multi-City</div>
            </div>
            
            <form id="travelSearchForm" class="search-form">
                <div class="form-group">
                    <label for="from">From</label>
                    <input type="text" id="from" placeholder="City or Airport" required>
                    <div id="fromSuggestions" class="suggestions"></div>
                </div>
                
                <div class="form-group">
                    <label for="to">To</label>
                    <input type="text" id="to" placeholder="City or Airport" required>
                    <div id="toSuggestions" class="suggestions"></div>
                </div>
                
                <div class="form-group" id="departureGroup">
                    <label for="departure">Departure</label>
                    <input type="date" id="departure" required>
                </div>
                
                <div class="form-group" id="returnGroup">
                    <label for="return">Return</label>
                    <input type="date" id="return">
                </div>
                
                <div class="form-group">
                    <label for="travelers">Travelers</label>
                    <select id="travelers">
                        <option value="1">1 Traveler</option>
                        <option value="2">2 Travelers</option>
                        <option value="3">3 Travelers</option>
                        <option value="4">4 Travelers</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="class">Class</label>
                    <select id="class">
                        <option value="economy">Economy</option>
                        <option value="premium">Premium Economy</option>
                        <option value="business">Business</option>
                        <option value="first">First Class</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary" id="searchBtn">
                        <i class="fas fa-search"></i> Find Best Options
                    </button>
                </div>
            </form>
            
            <!-- Results will be displayed here -->
            <div class="results-container" id="resultsContainer" style="display: none;">
                <div class="results-header">
                    <h3>Recommended Itineraries</h3>
                    <div class="sort-options">
                        <label>Sort by:</label>
                        <select id="sortOptions">
                            <option value="price">Price (Low to High)</option>
                            <option value="duration">Duration (Shortest)</option>
                            <option value="rating">Airline Rating</option>
                        </select>
                    </div>
                </div>
                
                <div id="itinerariesList"></div>
                <div id="complianceCheck" style="display: none;"></div>
                <div id="loadingIndicator" style="text-align: center; padding: 20px; display: none;">
                    <div class="loading"></div>
                    <p>Analyzing travel options...</p>
                </div>
            </div>
        </div>
        
        <!-- Expense Tracking Section -->
        <div class="expense-section">
            <h2 class="section-title"><i class="fas fa-receipt"></i> Expense Tracking</h2>
            
            <div class="expense-form">
                <div class="form-group">
                    <label for="expense-date">Date</label>
                    <input type="date" id="expense-date" required>
                </div>
                
                <div class="form-group">
                    <label for="expense-category">Category</label>
                    <select id="expense-category" required>
                        <option value="">Select Category</option>
                        <option value="flight">Flight</option>
                        <option value="hotel">Hotel</option>
                        <option value="meal">Meal</option>
                        <option value="transport">Transport</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="expense-amount">Amount</label>
                    <input type="number" id="expense-amount" placeholder="0.00" step="0.01" required>
                </div>
                
                <div class="form-group">
                    <label for="expense-currency">Currency</label>
                    <select id="expense-currency" required>
                        <option value="USD">USD ($)</option>
                        <option value="EUR">EUR (â‚¬)</option>
                        <option value="GBP">GBP (Â£)</option>
                        <option value="JPY">JPY (Â¥)</option>
                        <option value="CAD">CAD ($)</option>
                        <option value="AUD">AUD ($)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="expense-description">Description</label>
                    <input type="text" id="expense-description" placeholder="Brief description" required>
                </div>
            </div>
            
            <div class="receipt-upload" id="receiptUpload">
                <i class="fas fa-cloud-upload-alt"></i>
                <h4>Upload Receipt</h4>
                <p>Drag & drop receipt image or click to browse</p>
                <input type="file" id="receiptFile" accept="image/*, .pdf" style="display: none;">
            </div>
            
            <div id="receiptPreview" style="display: none; margin-top: 20px; text-align: center;">
                <img id="receiptImagePreview" src="#" alt="Receipt preview" style="max-width: 100%; max-height: 200px; border-radius: 10px; margin-bottom: 10px;">
                <button id="removeReceipt" class="btn btn-outline" style="margin-top: 10px;">
                    <i class="fas fa-trash"></i> Remove Receipt
                </button>
            </div>
            
            <div id="receiptAnalysis" style="display: none; margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 10px;">
                <h4><i class="fas fa-robot"></i> AI Receipt Analysis</h4>
                <div id="receiptAnalysisContent" style="margin-top: 10px;"></div>
            </div>
            
            <button id="addExpenseBtn" class="btn btn-primary" style="margin-top: 20px;">
                <i class="fas fa-plus"></i> Add Expense
            </button>
            
            <div class="expense-list">
                <div style="display: flex; justify-content: space-between; align-items: center; margin: 30px 0 15px;">
                    <h3>Recent Expenses</h3>
                    <div>
                        <span style="margin-right: 15px; font-weight: 600;">Total: <span id="totalExpenses">$0.00</span></span>
                        <button id="exportReportBtn" class="btn btn-outline">
                            <i class="fas fa-file-export"></i> Export Report
                        </button>
                    </div>
                </div>
                
                <div id="expensesList"></div>
                <div id="expensesLoading" style="text-align: center; padding: 20px; display: none;">
                    <div class="loading"></div>
                    <p>Loading expenses...</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- AI Chatbot Interface -->
    <div class="chatbot-container">
        <div class="chatbot-window" id="chatbotWindow">
            <div class="chatbot-header">
                <div>
                    <h3>Blossom AI Assistant</h3>
                    <p style="font-size: 12px;">Ask me about travel or expenses</p>
                </div>
                <button id="closeChatbot" style="background: none; border: none; color: white; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chatbot-messages" id="chatbotMessages">
                <div class="message bot-message">
                    Hello! I'm your Blossom Voyager AI assistant. How can I help with your travel plans or expenses today?
                </div>
            </div>
            <div class="chatbot-input">
                <input type="text" id="chatbotInput" placeholder="Type your question...">
                <button id="sendChatbotMessage">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
        <button class="chatbot-btn" id="chatbotBtn">
            <i class="fas fa-robot"></i>
        </button>
    </div>
    
    <!-- Modals -->
    <div class="modal" id="itineraryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Itinerary Details</h3>
                <button id="closeModal">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content will be loaded here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelModal">Cancel</button>
                <button class="btn btn-primary" id="confirmModal">Book Now</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Export Expense Report</h3>
                <button class="closeReportModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="reportStartDate">Start Date</label>
                    <input type="date" id="reportStartDate">
                </div>
                <div class="form-group">
                    <label for="reportEndDate">End Date</label>
                    <input type="date" id="reportEndDate">
                </div>
                <div class="form-group">
                    <label for="reportFormat">Format</label>
                    <select id="reportFormat">
                        <option value="pdf">PDF</option>
                        <option value="csv">CSV</option>
                        <option value="excel">Excel</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline closeReportModal">Cancel</button>
                <button class="btn btn-primary" id="generateReportBtn">Generate Report</button>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let userData = {};
        let travelData = [];
        let expenseData = [];
        let currentReceipt = null;
        let chatHistory = [];
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Load user data
            loadUserData();
            
            // Setup event listeners
            setupEventListeners();
            
            // Load expenses
            loadExpenses();
        });
        
        // Load user data from localStorage or API
        function loadUserData() {
            // In a real app, this would come from an API
            const storedUser = localStorage.getItem('blossomUser');
            if (storedUser) {
                userData = JSON.parse(storedUser);
            } else {
                // Default user data
                userData = {
                    name: "Alex Johnson",
                    email: "alex.johnson@example.com",
                    company: "Acme Inc.",
                    travelPreferences: {
                        preferredAirlines: ["Delta", "United"],
                        seatPreference: "window",
                        mealPreference: "vegetarian"
                    },
                    expenseSettings: {
                        defaultCurrency: "USD",
                        expenseCategories: ["flight", "hotel", "meal", "transport", "other"]
                    }
                };
                localStorage.setItem('blossomUser', JSON.stringify(userData));
            }
            
            document.getElementById('username').textContent = userData.name;
        }
        
        // Setup all event listeners
        function setupEventListeners() {
            // Tab switching
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show/hide return date based on tab
                    const returnGroup = document.getElementById('returnGroup');
                    if (tab.dataset.type === 'oneway') {
                        returnGroup.style.display = 'none';
                    } else {
                        returnGroup.style.display = 'block';
                    }
                });
            });
            
            // Travel search form
            document.getElementById('travelSearchForm').addEventListener('submit', function(e) {
                e.preventDefault();
                searchTravel();
            });
            
            // Sort options
            document.getElementById('sortOptions').addEventListener('change', function() {
                sortItineraries(this.value);
            });
            
            // Receipt upload
            const receiptUpload = document.getElementById('receiptUpload');
            const receiptFile = document.getElementById('receiptFile');
            
            receiptUpload.addEventListener('click', () => {
                receiptFile.click();
            });
            
            receiptFile.addEventListener('change', handleReceiptUpload);
            
            // Drag and drop for receipts
            receiptUpload.addEventListener('dragover', (e) => {
                e.preventDefault();
                receiptUpload.style.borderColor = 'var(--primary)';
                receiptUpload.style.backgroundColor = 'rgba(76, 175, 80, 0.05)';
            });
            
            receiptUpload.addEventListener('dragleave', () => {
                receiptUpload.style.borderColor = '#ddd';
                receiptUpload.style.backgroundColor = 'transparent';
            });
            
            receiptUpload.addEventListener('drop', (e) => {
                e.preventDefault();
                receiptUpload.style.borderColor = '#ddd';
                receiptUpload.style.backgroundColor = 'transparent';
                
                if (e.dataTransfer.files.length > 0) {
                    receiptFile.files = e.dataTransfer.files;
                    handleReceiptUpload();
                }
            });
            
            // Remove receipt
            document.getElementById('removeReceipt').addEventListener('click', function() {
                currentReceipt = null;
                document.getElementById('receiptFile').value = '';
                document.getElementById('receiptPreview').style.display = 'none';
                document.getElementById('receiptAnalysis').style.display = 'none';
                document.getElementById('receiptUpload').style.display = 'block';
            });
            
            // Add expense button
            document.getElementById('addExpenseBtn').addEventListener('click', addExpense);
            
            // Export report button
            document.getElementById('exportReportBtn').addEventListener('click', function() {
                document.getElementById('reportModal').style.display = 'flex';
            });
            
            // Close report modal
            document.querySelector('.closeReportModal').addEventListener('click', function() {
                document.getElementById('reportModal').style.display = 'none';
            });
            
            // Generate report button
            document.getElementById('generateReportBtn').addEventListener('click', generateReport);
            
            // Chatbot toggle
            document.getElementById('chatbotBtn').addEventListener('click', toggleChatbot);
            document.getElementById('closeChatbot').addEventListener('click', toggleChatbot);
            
            // Send chatbot message
            document.getElementById('sendChatbotMessage').addEventListener('click', sendChatbotMessage);
            document.getElementById('chatbotInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendChatbotMessage();
                }
            });
            
            // Close modal
            document.getElementById('closeModal').addEventListener('click', function() {
                document.getElementById('itineraryModal').style.display = 'none';
            });
            
            document.getElementById('cancelModal').addEventListener('click', function() {
                document.getElementById('itineraryModal').style.display = 'none';
            });
            
            // City/airport autocomplete
            document.getElementById('from').addEventListener('input', function() {
                fetchCitySuggestions(this.value, 'fromSuggestions');
            });
            
            document.getElementById('to').addEventListener('input', function() {
                fetchCitySuggestions(this.value, 'toSuggestions');
            });
        }
        
        // Search for travel options
        async function searchTravel() {
            const from = document.getElementById('from').value;
            const to = document.getElementById('to').value;
            const departure = document.getElementById('departure').value;
            const returnDate = document.getElementById('return').value;
            const travelers = document.getElementById('travelers').value;
            const travelClass = document.getElementById('class').value;
            
            if (!from || !to || !departure) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Show loading indicator
            document.getElementById('resultsContainer').style.display = 'block';
            document.getElementById('itinerariesList').innerHTML = '';
            document.getElementById('loadingIndicator').style.display = 'block';
            document.getElementById('searchBtn').disabled = true;
            document.getElementById('searchBtn').innerHTML = '<div class="loading" style="display: inline-block; margin-right: 8px;"></div> Searching...';
            
            try {
                // In a real app, this would be an API call to your backend
                // For this demo, we'll simulate an API call with setTimeout
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Simulated API response
                const mockResponse = await generateMockTravelData(from, to, departure, returnDate, travelers, travelClass);
                travelData = mockResponse.itineraries;
                
                // Display results
                displayItineraries(travelData);
                
                // Check travel compliance
                checkTravelCompliance(to);
                
            } catch (error) {
                console.error('Error searching for travel:', error);
                alert('There was an error searching for travel options. Please try again.');
            } finally {
                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('searchBtn').disabled = false;
                document.getElementById('searchBtn').innerHTML = '<i class="fas fa-search"></i> Find Best Options';
            }
        }
        
        // Generate mock travel data for demo purposes
        async function generateMockTravelData(from, to, departure, returnDate, travelers, travelClass) {
            // This would be replaced with actual API calls in production
            const airlines = ["Delta", "United", "American", "Lufthansa", "British Airways", "Air France"];
            const hotels = ["Marriott", "Hilton", "Hyatt", "InterContinental", "Sheraton", "Holiday Inn"];
            const carRentals = ["Hertz", "Avis", "Enterprise", "Budget", "National", "Alamo"];
            
            const itineraries = [];
            const basePrice = Math.floor(Math.random() * 500) + 300;
            const days = returnDate ? (new Date(returnDate) - new Date(departure)) / (1000 * 60 * 60 * 24) : 0;
            
            for (let i = 0; i < 5; i++) {
                const flightPrice = basePrice + Math.floor(Math.random() * 200);
                const hotelPrice = Math.floor(Math.random() * 150) + 50;
                const carPrice = Math.floor(Math.random() * 30) + 20;
                
                itineraries.push({
                    id: `itinerary-${i}`,
                    from,
                    to,
                    departure,
                    return: returnDate,
                    travelers,
                    class: travelClass,
                    totalPrice: flightPrice + (hotelPrice * (days || 1)) + (carPrice * (days || 1)),
                    flight: {
                        airline: airlines[Math.floor(Math.random() * airlines.length)],
                        flightNumber: `DL${Math.floor(Math.random() * 2000) + 1000}`,
                        departureTime: `${Math.floor(Math.random() * 12) + 6}:00 AM`,
                        arrivalTime: `${Math.floor(Math.random() * 12) + 1}:00 PM`,
                        duration: `${Math.floor(Math.random() * 4) + 2}h ${Math.floor(Math.random() * 50) + 10}m`,
                        price: flightPrice,
                        bookingUrl: `https://www.delta.com/flights/book?flight=${Math.floor(Math.random() * 1000000)}`
                    },
                    hotel: {
                        name: `${hotels[Math.floor(Math.random() * hotels.length)]} ${to.split(',')[0]}`,
                        rating: Math.floor(Math.random() * 2) + 3,
                        pricePerNight: hotelPrice,
                        cancellation: Math.random() > 0.3 ? "Free cancellation" : "Non-refundable",
                        nights: days || 1,
                        bookingUrl: `https://www.marriott.com/search/hotelList.mi?city=${to.split(',')[0]}`
                    },
                    car: {
                        company: carRentals[Math.floor(Math.random() * carRentals.length)],
                        type: ["Compact", "Midsize", "Fullsize", "SUV", "Luxury"][Math.floor(Math.random() * 5)],
                        pricePerDay: carPrice,
                        unlimitedMileage: Math.random() > 0.5,
                        bookingUrl: `https://www.hertz.com/rentacar/reservation/`
                    }
                });
            }
            
            // Sort by price
            itineraries.sort((a, b) => a.totalPrice - b.totalPrice);
            
            return { itineraries };
        }
        
        // Display itineraries in the UI
        function displayItineraries(itineraries) {
            const itinerariesList = document.getElementById('itinerariesList');
            itinerariesList.innerHTML = '';
            
            itineraries.forEach(itinerary => {
                const card = document.createElement('div');
                card.className = 'itinerary-card';
                card.dataset.id = itinerary.id;
                
                const days = itinerary.return ? (new Date(itinerary.return) - new Date(itinerary.departure)) / (1000 * 60 * 60 * 24) : 1;
                
                card.innerHTML = `
                    <div class="itinerary-header">
                        <div>
                            <h4>${itinerary.from} to ${itinerary.to}</h4>
                            <p>${formatDate(itinerary.departure)} ${itinerary.return ? ' - ' + formatDate(itinerary.return) : ''} â€¢ ${itinerary.travelers} Traveler${itinerary.travelers > 1 ? 's' : ''} â€¢ ${itinerary.class.charAt(0).toUpperCase() + itinerary.class.slice(1)}</p>
                        </div>
                        <div class="itinerary-price">$${itinerary.totalPrice.toLocaleString()}</div>
                    </div>
                    <div class="itinerary-body">
                        <div class="segment">
                            <div class="segment-icon">
                                <i class="fas fa-plane"></i>
                            </div>
                            <div class="segment-details">
                                <h4>Flight</h4>
                                <p>${itinerary.flight.airline} â€¢ ${itinerary.flight.duration}</p>
                                <p>${itinerary.flight.departureTime} - ${itinerary.flight.arrivalTime}</p>
                                <p>$${itinerary.flight.price}</p>
                            </div>
                        </div>
                        <div class="segment">
                            <div class="segment-icon">
                                <i class="fas fa-hotel"></i>
                            </div>
                            <div class="segment-details">
                                <h4>Hotel</h4>
                                <p>${itinerary.hotel.name} â€¢ ${days} night${days > 1 ? 's' : ''}</p>
                                <p>$${itinerary.hotel.pricePerNight}/night â€¢ ${itinerary.hotel.cancellation}</p>
                            </div>
                        </div>
                        <div class="segment">
                            <div class="segment-icon">
                                <i class="fas fa-car"></i>
                            </div>
                            <div class="segment-details">
                                <h4>Transport</h4>
                                <p>${itinerary.car.company} â€¢ ${itinerary.car.type}</p>
                                <p>$${itinerary.car.pricePerDay}/day â€¢ ${itinerary.car.unlimitedMileage ? 'Unlimited mileage' : 'Limited mileage'}</p>
                            </div>
                        </div>
                    </div>
                    <div class="itinerary-footer">
                        <button class="btn btn-outline view-details" data-id="${itinerary.id}">
                            <i class="fas fa-info-circle"></i> Details
                        </button>
                        <button class="btn btn-primary book-now" data-id="${itinerary.id}" style="margin-left: 10px;">
                            <i class="fas fa-external-link-alt"></i> Book Now
                        </button>
                    </div>
                `;
                
                itinerariesList.appendChild(card);
            });
            
            // Add event listeners to the new buttons
            document.querySelectorAll('.view-details').forEach(btn => {
                btn.addEventListener('click', function() {
                    showItineraryDetails(this.dataset.id);
                });
            });
            
            document.querySelectorAll('.book-now').forEach(btn => {
                btn.addEventListener('click', function() {
                    bookItinerary(this.dataset.id);
                });
            });
        }
        
        // Sort itineraries based on selected option
        function sortItineraries(sortBy) {
            if (!travelData.length) return;
            
            let sortedItineraries = [...travelData];
            
            switch(sortBy) {
                case 'price':
                    sortedItineraries.sort((a, b) => a.totalPrice - b.totalPrice);
                    break;
                case 'duration':
                    // Sort by flight duration (simplified)
                    sortedItineraries.sort((a, b) => {
                        const aDuration = parseInt(a.flight.duration.split('h')[0]);
                        const bDuration = parseInt(b.flight.duration.split('h')[0]);
                        return aDuration - bDuration;
                    });
                    break;
                case 'rating':
                    // Sort by hotel rating (simplified)
                    sortedItineraries.sort((a, b) => b.hotel.rating - a.hotel.rating);
                    break;
            }
            
            displayItineraries(sortedItineraries);
        }
        
        // Show itinerary details in modal
        function showItineraryDetails(id) {
            const itinerary = travelData.find(item => item.id === id);
            if (!itinerary) return;
            
            document.getElementById('modalTitle').textContent = `Itinerary Details: ${itinerary.from} to ${itinerary.to}`;
            
            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--primary); margin-bottom: 10px;">Flight Details</h4>
                    <p><strong>Airline:</strong> ${itinerary.flight.airline} (${itinerary.flight.flightNumber})</p>
                    <p><strong>Departure:</strong> ${itinerary.departure} at ${itinerary.flight.departureTime}</p>
                    <p><strong>Arrival:</strong> ${itinerary.flight.arrivalTime}</p>
                    <p><strong>Duration:</strong> ${itinerary.flight.duration}</p>
                    <p><strong>Class:</strong> ${itinerary.class.charAt(0).toUpperCase() + itinerary.class.slice(1)}</p>
                    <p><strong>Price:</strong> $${itinerary.flight.price}</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--primary); margin-bottom: 10px;">Accommodation</h4>
                    <p><strong>Hotel:</strong> ${itinerary.hotel.name}</p>
                    <p><strong>Rating:</strong> ${'â˜…'.repeat(itinerary.hotel.rating)}${'â˜†'.repeat(5 - itinerary.hotel.rating)}</p>
                    <p><strong>Check-in:</strong> ${itinerary.departure}</p>
                    <p><strong>Check-out:</strong> ${itinerary.return || itinerary.departure}</p>
                    <p><strong>Nights:</strong> ${itinerary.return ? (new Date(itinerary.return) - new Date(itinerary.departure)) / (1000 * 60 * 60 * 24) : 1}</p>
                    <p><strong>Price per night:</strong> $${itinerary.hotel.pricePerNight}</p>
                    <p><strong>Cancellation:</strong> ${itinerary.hotel.cancellation}</p>
                </div>
                
                <div>
                    <h4 style="color: var(--primary); margin-bottom: 10px;">Transportation</h4>
                    <p><strong>Car Rental:</strong> ${itinerary.car.company}</p>
                    <p><strong>Car Type:</strong> ${itinerary.car.type}</p>
                    <p><strong>Price per day:</strong> $${itinerary.car.pricePerDay}</p>
                    <p><strong>Mileage:</strong> ${itinerary.car.unlimitedMileage ? 'Unlimited' : 'Limited'}</p>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: var(--light); border-radius: 10px;">
                    <h4 style="color: var(--primary); margin-bottom: 10px;">Total Price: $${itinerary.totalPrice}</h4>
                    <p>Includes flight, ${itinerary.return ? (new Date(itinerary.return) - new Date(itinerary.departure)) / (1000 * 60 * 60 * 24) : 1} night${itinerary.return && (new Date(itinerary.return) - new Date(itinerary.departure)) / (1000 * 60 * 60 * 24) > 1 ? 's' : ''} accommodation, and car rental</p>
                </div>
            `;
            
            document.getElementById('confirmModal').textContent = 'Book Now';
            document.getElementById('confirmModal').onclick = function() {
                bookItinerary(id);
                document.getElementById('itineraryModal').style.display = 'none';
            };
            
            document.getElementById('itineraryModal').style.display = 'flex';
        }
        
        // Book itinerary (would redirect to booking site in production)
        function bookItinerary(id) {
            const itinerary = travelData.find(item => item.id === id);
            if (!itinerary) return;
            
            // In a real app, this would redirect to the booking site
            alert(`Redirecting to booking site for ${itinerary.flight.airline} flight to ${itinerary.to}`);
            window.open(itinerary.flight.bookingUrl, '_blank');
        }
        
        // Check travel compliance for destination
        function checkTravelCompliance(destination) {
            const complianceCheck = document.getElementById('complianceCheck');
            complianceCheck.style.display = 'block';
            
            // This would come from an API in production
            const country = destination.split(',')[1] ? destination.split(',')[1].trim() : 'United States';
            const visaRequirements = getVisaRequirements(country);
            const healthRequirements = getHealthRequirements(country);
            
            complianceCheck.innerHTML = `
                <div class="itinerary-card" style="background: #fff8e1;">
                    <div class="itinerary-header" style="background: rgba(255, 193, 7, 0.1);">
                        <div>
                            <h4><i class="fas fa-passport"></i> Travel Compliance Check</h4>
                            <p>Important information for your trip to ${country}</p>
                        </div>
                    </div>
                    <div class="itinerary-body">
                        <div class="segment">
                            <div class="segment-icon" style="background: rgba(255, 193, 7, 0.1); color: var(--warning);">
                                <i class="fas fa-passport"></i>
                            </div>
                            <div class="segment-details">
                                <h4>Visa Requirements</h4>
                                <p>${visaRequirements}</p>
                                ${country !== 'United States' ? `<p style="margin-top: 5px;"><a href="https://travel.state.gov/content/travel/en/international-travel.html" target="_blank" style="color: var(--primary);">Check official requirements</a></p>` : ''}
                            </div>
                        </div>
                        <div class="segment">
                            <div class="segment-icon" style="background: rgba(255, 193, 7, 0.1); color: var(--warning);">
                                <i class="fas fa-syringe"></i>
                            </div>
                            <div class="segment-details">
                                <h4>Health Requirements</h4>
                                <p>${healthRequirements}</p>
                                ${healthRequirements.includes('recommended') ? `<p style="margin-top: 5px;"><a href="https://wwwnc.cdc.gov/travel" target="_blank" style="color: var(--primary);">CDC Travel Health Notices</a></p>` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Get visa requirements (mock data)
        function getVisaRequirements(country) {
            const visaFreeCountries = ["United Kingdom", "Canada", "Mexico", "France", "Germany", "Italy", "Japan"];
            const visaOnArrival = ["Thailand", "Indonesia", "Sri Lanka", "Kenya"];
            const etaCountries = ["Australia", "New Zealand"];
            
            if (country === "United States") return "Domestic travel - no visa required";
            if (visaFreeCountries.includes(country)) return "No visa required for stays under 90 days";
            if (visaOnArrival.includes(country)) return "Visa available on arrival for tourism (typically $25-$50)";
            if (etaCountries.includes(country)) return "Electronic Travel Authorization (ETA) required before departure";
            
            return "Visa required before travel. Apply at nearest embassy or consulate.";
        }
        
        // Get health requirements (mock data)
        function getHealthRequirements(country) {
            const yellowFeverCountries = ["Brazil", "Peru", "Ghana", "Nigeria"];
            const malariaCountries = ["India", "Thailand", "Vietnam", "South Africa"];
            
            if (yellowFeverCountries.includes(country)) return "Yellow fever vaccination required";
            if (malariaCountries.includes(country)) return "Malaria prophylaxis recommended";
            if (country === "United States") return "No vaccination requirements";
            
            return "Routine vaccinations recommended";
        }
        
        // Handle receipt upload
        function handleReceiptUpload() {
            const fileInput = document.getElementById('receiptFile');
            if (fileInput.files.length === 0) return;
            
            const file = fileInput.files[0];
            currentReceipt = file;
            
            // Show preview
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('receiptImagePreview').src = e.target.result;
                    document.getElementById('receiptPreview').style.display = 'block';
                    document.getElementById('receiptUpload').style.display = 'none';
                    
                    // Analyze receipt (simulated)
                    simulateReceiptAnalysis(file);
                };
                reader.readAsDataURL(file);
            } else {
                document.getElementById('receiptPreview').style.display = 'none';
                document.getElementById('receiptUpload').style.display = 'none';
                
                // Show PDF icon for PDF files
                document.getElementById('receiptAnalysisContent').innerHTML = `
                    <div style="text-align: center;">
                        <i class="fas fa-file-pdf" style="font-size: 40px; color: var(--primary);"></i>
                        <p>${file.name}</p>
                    </div>
                `;
                document.getElementById('receiptAnalysis').style.display = 'block';
                
                // Analyze receipt (simulated)
                simulateReceiptAnalysis(file);
            }
        }
        
        // Simulate receipt analysis (would be AI in production)
        function simulateReceiptAnalysis(file) {
            document.getElementById('receiptAnalysis').style.display = 'block';
            document.getElementById('receiptAnalysisContent').innerHTML = `
                <div style="text-align: center;">
                    <div class="loading" style="margin: 10px auto;"></div>
                    <p>Analyzing receipt...</p>
                </div>
            `;
            
            // Simulate API call delay
            setTimeout(() => {
                const categories = ["Flight", "Hotel", "Meal", "Transport", "Other"];
                const merchants = ["Delta Airlines", "Marriott Hotel", "Uber", "Starbucks", "Amazon", "Local Restaurant"];
                const randomCategory = categories[Math.floor(Math.random() * categories.length)];
                const randomMerchant = merchants[Math.floor(Math.random() * merchants.length)];
                const randomAmount = (Math.random() * 200 + 20).toFixed(2);
                const randomDate = new Date(Date.now() - Math.floor(Math.random() * 30) * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                
                document.getElementById('receiptAnalysisContent').innerHTML = `
                    <div style="margin-bottom: 10px;">
                        <p><strong>Merchant:</strong> ${randomMerchant}</p>
                        <p><strong>Amount:</strong> $${randomAmount}</p>
                        <p><strong>Date:</strong> ${randomDate}</p>
                        <p><strong>Category:</strong> ${randomCategory}</p>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-outline" style="padding: 5px 10px; font-size: 12px;" onclick="applyReceiptAnalysis('${randomMerchant}', ${randomAmount}, '${randomDate}', '${randomCategory.toLowerCase()}')">
                            <i class="fas fa-check"></i> Use This Data
                        </button>
                        <button class="btn btn-outline" style="padding: 5px 10px; font-size: 12px;" onclick="document.getElementById('receiptAnalysisContent').innerHTML += '<div style=&#39;margin-top:10px&#39;><label>Correct Details:</label><input type=&#39;text&#39; id=&#39;correctMerchant&#39; placeholder=&#39;Merchant name&#39; style=&#39;margin-bottom:5px;width:100%&#39;><input type=&#39;number&#39; id=&#39;correctAmount&#39; placeholder=&#39;Amount&#39; style=&#39;margin-bottom:5px;width:100%&#39;><input type=&#39;date&#39; id=&#39;correctDate&#39; style=&#39;margin-bottom:5px;width:100%&#39;><select id=&#39;correctCategory&#39; style=&#39;width:100%&#39;><option value=&#39;flight&#39;>Flight</option><option value=&#39;hotel&#39;>Hotel</option><option value=&#39;meal&#39;>Meal</option><option value=&#39;transport&#39;>Transport</option><option value=&#39;other&#39;>Other</option></select><button class=&#39;btn btn-primary&#39; style=&#39;width:100%;margin-top:5px&#39; onclick=&#39;applyManualReceiptData()&#39;>Apply Changes</button></div>'">
                            <i class="fas fa-edit"></i> Correct Data
                        </button>
                    </div>
                `;
            }, 2000);
        }
        
        // Apply receipt analysis to form
        function applyReceiptAnalysis(merchant, amount, date, category) {
            document.getElementById('expense-description').value = merchant;
            document.getElementById('expense-amount').value = amount;
            document.getElementById('expense-date').value = date;
            document.getElementById('expense-category').value = category;
        }
        
        // Apply manual receipt data
        function applyManualReceiptData() {
            const merchant = document.getElementById('correctMerchant').value;
            const amount = document.getElementById('correctAmount').value;
            const date = document.getElementById('correctDate').value;
            const category = document.getElementById('correctCategory').value;
            
            if (merchant && amount && date && category) {
                applyReceiptAnalysis(merchant, amount, date, category);
            }
        }
        
        // Add new expense
        function addExpense() {
            const date = document.getElementById('expense-date').value;
            const category = document.getElementById('expense-category').value;
            const amount = document.getElementById('expense-amount').value;
            const currency = document.getElementById('expense-currency').value;
            const description = document.getElementById('expense-description').value;
            
            if (!date || !category || !amount || !description) {
                alert('Please fill in all required fields');
                return;
            }
            
            const newExpense = {
                id: `expense-${Date.now()}`,
                date,
                category,
                amount: parseFloat(amount),
                currency,
                description,
                receipt: currentReceipt ? currentReceipt.name : null,
                status: 'pending'
            };
            
            // In a real app, this would be an API call
            expenseData.unshift(newExpense);
            saveExpenses();
            loadExpenses();
            
            // Reset form
            document.getElementById('expense-date').value = '';
            document.getElementById('expense-category').value = '';
            document.getElementById('expense-amount').value = '';
            document.getElementById('expense-description').value = '';
            document.getElementById('receiptFile').value = '';
            document.getElementById('receiptPreview').style.display = 'none';
            document.getElementById('receiptAnalysis').style.display = 'none';
            document.getElementById('receiptUpload').style.display = 'block';
            currentReceipt = null;
            
            // Show success message
            alert('Expense added successfully!');
        }
        
        // Load expenses from localStorage or API
        function loadExpenses() {
            // In a real app, this would come from an API
            const storedExpenses = localStorage.getItem('blossomExpenses');
            if (storedExpenses) {
                expenseData = JSON.parse(storedExpenses);
            } else {
                // Default sample expenses
                expenseData = [
                    {
                        id: 'expense-1',
                        date: '2023-06-15',
                        category: 'flight',
                        amount: 1247.00,
                        currency: 'USD',
                        description: 'Flight to London',
                        receipt: 'flight-receipt.jpg',
                        status: 'approved'
                    },
                    {
                        id: 'expense-2',
                        date: '2023-06-16',
                        category: 'hotel',
                        amount: 225.00,
                        currency: 'USD',
                        description: 'Hotel deposit',
                        receipt: 'hotel-receipt.pdf',
                        status: 'approved'
                    },
                    {
                        id: 'expense-3',
                        date: '2023-06-17',
                        category: 'meal',
                        amount: 45.50,
                        currency: 'USD',
                        description: 'Dinner with client',
                        receipt: null,
                        status: 'pending'
                    }
                ];
                saveExpenses();
            }
            
            displayExpenses();
        }
        
        // Save expenses to localStorage or API
        function saveExpenses() {
            localStorage.setItem('blossomExpenses', JSON.stringify(expenseData));
        }
        
        // Display expenses in the UI
        function displayExpenses() {
            const expensesList = document.getElementById('expensesList');
            expensesList.innerHTML = '';
            
            if (expenseData.length === 0) {
                expensesList.innerHTML = '<p style="text-align: center; padding: 20px; color: #666;">No expenses recorded yet</p>';
                document.getElementById('totalExpenses').textContent = '$0.00';
                return;
            }
            
            let total = 0;
            
            expenseData.forEach(expense => {
                total += expense.amount;
                
                const item = document.createElement('div');
                item.className = 'expense-item';
                item.dataset.id = expense.id;
                
                const categoryIcons = {
                    flight: 'fa-plane',
                    hotel: 'fa-hotel',
                    meal: 'fa-utensils',
                    transport: 'fa-car',
                    other: 'fa-receipt'
                };
                
                const statusBadges = {
                    approved: '<span style="color: var(--primary); font-size: 12px; background: rgba(76, 175, 80, 0.1); padding: 3px 8px; border-radius: 10px;"><i class="fas fa-check-circle"></i> Approved</span>',
                    pending: '<span style="color: var(--warning); font-size: 12px; background: rgba(255, 193, 7, 0.1); padding: 3px 8px; border-radius: 10px;"><i class="fas fa-clock"></i> Pending</span>',
                    rejected: '<span style="color: var(--error); font-size: 12px; background: rgba(244, 67, 54, 0.1); padding: 3px 8px; border-radius: 10px;"><i class="fas fa-times-circle"></i> Rejected</span>'
                };
                
                item.innerHTML = `
                    <div class="expense-info">
                        <div class="expense-category">
                            <i class="fas ${categoryIcons[expense.category]}"></i>
                        </div>
                        <div>
                            <h4>${expense.description}</h4>
                            <p>${formatDate(expense.date)} â€¢ ${expense.receipt ? '<i class="fas fa-paperclip"></i> Receipt attached' : 'No receipt'}</p>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div class="expense-amount">${formatCurrency(expense.amount, expense.currency)}</div>
                        ${statusBadges[expense.status]}
                    </div>
                `;
                
                expensesList.appendChild(item);
            });
            
            document.getElementById('totalExpenses').textContent = formatCurrency(total, 'USD');
        }
        
        // Generate expense report
        function generateReport() {
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const format = document.getElementById('reportFormat').value;
            
            if (!startDate || !endDate) {
                alert('Please select both start and end dates');
                return;
            }
            
            // Filter expenses by date range
            const filteredExpenses = expenseData.filter(expense => {
                return expense.date >= startDate && expense.date <= endDate;
            });
            
            if (filteredExpenses.length === 0) {
                alert('No expenses found in the selected date range');
                return;
            }
            
            // In a real app, this would generate and download a file
            alert(`Generating ${format.toUpperCase()} report for ${filteredExpenses.length} expenses between ${startDate} and ${endDate}`);
            
            // Close modal
            document.getElementById('reportModal').style.display = 'none';
        }
        
        // Toggle chatbot window
        function toggleChatbot() {
            const chatbotWindow = document.getElementById('chatbotWindow');
            if (chatbotWindow.style.display === 'flex') {
                chatbotWindow.style.display = 'none';
            } else {
                chatbotWindow.style.display = 'flex';
                document.getElementById('chatbotInput').focus();
            }
        }
        
        // Send chatbot message
        function sendChatbotMessage() {
            const input = document.getElementById('chatbotInput');
            const message = input.value.trim();
            if (!message) return;
            
            // Add user message to chat
            addChatMessage(message, 'user');
            input.value = '';
            
            // Add loading indicator
            const loadingMsg = document.createElement('div');
            loadingMsg.className = 'message bot-message';
            loadingMsg.innerHTML = '<div class="loading" style="display: inline-block; margin-right: 8px;"></div> Thinking...';
            document.getElementById('chatbotMessages').appendChild(loadingMsg);
            document.getElementById('chatbotMessages').scrollTop = document.getElementById('chatbotMessages').scrollHeight;
            
            // Simulate AI response (in a real app, this would be an API call)
            setTimeout(() => {
                // Remove loading indicator
                document.getElementById('chatbotMessages').removeChild(loadingMsg);
                
                // Generate response
                const response = generateAIResponse(message);
                addChatMessage(response, 'bot');
            }, 1500);
        }
        
        // Add message to chat
        function addChatMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.textContent = text;
            document.getElementById('chatbotMessages').appendChild(messageDiv);
            document.getElementById('chatbotMessages').scrollTop = document.getElementById('chatbotMessages').scrollHeight;
            
            // Add to chat history
            chatHistory.push({ sender, text });
        }
        
        // Generate AI response (simulated)
        function generateAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
                return "Hello! How can I assist you with your travel plans or expenses today?";
            }
            
            if (lowerMessage.includes('travel') || lowerMessage.includes('flight') || lowerMessage.includes('hotel')) {
                return "I can help you find the best travel options. Try searching for flights using the form above, or ask me specific questions about your trip.";
            }
            
            if (lowerMessage.includes('expense') || lowerMessage.includes('receipt')) {
                return "For expenses, you can upload receipts and I'll help categorize them. Make sure to fill in all the details in the expense form for accurate tracking.";
            }
            
            if (lowerMessage.includes('visa') || lowerMessage.includes('requirement')) {
                return "Visa requirements depend on your destination. I automatically check visa requirements when you search for travel to international destinations.";
            }
            
            if (lowerMessage.includes('thank')) {
                return "You're welcome! Let me know if there's anything else I can help with.";
            }
            
            // Default response
            return "I'm your Blossom Voyager AI assistant. I can help with travel planning, expense tracking, and answering questions about your trips. How can I assist you?";
        }
        
        // Fetch city/airport suggestions
        async function fetchCitySuggestions(query, targetId) {
            if (query.length < 2) {
                document.getElementById(targetId).innerHTML = '';
                return;
            }
            
            // In a real app, this would be an API call
            const mockSuggestions = [
                { name: "New York, US (JFK)", code: "JFK" },
                { name: "New York, US (LGA)", code: "LGA" },
                { name: "Newark, US (EWR)", code: "EWR" },
                { name: "New Orleans, US (MSY)", code: "MSY" },
                { name: "New Delhi, India (DEL)", code: "DEL" }
            ].filter(item => item.name.toLowerCase().includes(query.toLowerCase()));
            
            const suggestionsDiv = document.getElementById(targetId);
            suggestionsDiv.innerHTML = '';
            
            mockSuggestions.forEach(item => {
                const suggestion = document.createElement('div');
                suggestion.style.padding = '8px 12px';
                suggestion.style.cursor = 'pointer';
                suggestion.style.borderBottom = '1px solid #eee';
                suggestion.style.fontSize = '14px';
                suggestion.textContent = item.name;
                
                suggestion.addEventListener('click', function() {
                    document.getElementById(targetId === 'fromSuggestions' ? 'from' : 'to').value = item.name;
                    suggestionsDiv.innerHTML = '';
                });
                
                suggestionsDiv.appendChild(suggestion);
            });
            
            if (mockSuggestions.length > 0) {
                suggestionsDiv.style.display = 'block';
                suggestionsDiv.style.border = '1px solid #ddd';
                suggestionsDiv.style.borderRadius = '0 0 5px 5px';
                suggestionsDiv.style.backgroundColor = 'white';
                suggestionsDiv.style.maxHeight = '200px';
                suggestionsDiv.style.overflowY = 'auto';
                suggestionsDiv.style.position = 'absolute';
                suggestionsDiv.style.width = 'calc(100% - 24px)';
                suggestionsDiv.style.zIndex = '100';
            } else {
                suggestionsDiv.style.display = 'none';
            }
        }
        
        // Helper function to format date
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }
        
        // Helper function to format currency
        function formatCurrency(amount, currency) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: currency || 'USD'
            }).format(amount);
        }
        
        // Make helper functions available globally
        window.applyReceiptAnalysis = applyReceiptAnalysis;
        window.applyManualReceiptData = applyManualReceiptData;
    </script>
</body>
</html>